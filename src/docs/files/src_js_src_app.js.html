<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src&#x2F;js&#x2F;src&#x2F;app.js - uMobile</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="uMobile"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/auth.Authentication.html">auth.Authentication</a></li>
            
                <li><a href="..&#x2F;classes/collection.ModuleCollection.html">collection.ModuleCollection</a></li>
            
                <li><a href="..&#x2F;classes/model.Credential.html">model.Credential</a></li>
            
                <li><a href="..&#x2F;classes/model.Module.html">model.Module</a></li>
            
                <li><a href="..&#x2F;classes/model.Notifier.html">model.Notifier</a></li>
            
                <li><a href="..&#x2F;classes/model.State.html">model.State</a></li>
            
                <li><a href="..&#x2F;classes/router.RouteManager.html">router.RouteManager</a></li>
            
                <li><a href="..&#x2F;classes/session.SessionTracker.html">session.SessionTracker</a></li>
            
                <li><a href="..&#x2F;classes/session.SessionTrackerMock.html">session.SessionTrackerMock</a></li>
            
                <li><a href="..&#x2F;classes/storage.DB.html">storage.DB</a></li>
            
                <li><a href="..&#x2F;classes/storage.Local.html">storage.Local</a></li>
            
                <li><a href="..&#x2F;classes/storage.Storage.html">storage.Storage</a></li>
            
                <li><a href="..&#x2F;classes/utility.Utils.html">utility.Utils</a></li>
            
                <li><a href="..&#x2F;classes/view.Base.html">view.Base</a></li>
            
                <li><a href="..&#x2F;classes/view.Breadcrumb.html">view.Breadcrumb</a></li>
            
                <li><a href="..&#x2F;classes/view.DashboardView.html">view.DashboardView</a></li>
            
                <li><a href="..&#x2F;classes/view.Footer.html">view.Footer</a></li>
            
                <li><a href="..&#x2F;classes/view.Header.html">view.Header</a></li>
            
                <li><a href="..&#x2F;classes/view.LoadedView.html">view.LoadedView</a></li>
            
                <li><a href="..&#x2F;classes/view.Login.html">view.Login</a></li>
            
                <li><a href="..&#x2F;classes/view.Module.html">view.Module</a></li>
            
                <li><a href="..&#x2F;classes/view.ModuleView.html">view.ModuleView</a></li>
            
                <li><a href="..&#x2F;classes/view.Notifier.html">view.Notifier</a></li>
            
                <li><a href="..&#x2F;classes/view.Page.html">view.Page</a></li>
            
                <li><a href="..&#x2F;classes/view.ViewManager.html">view.ViewManager</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/app.html">app</a></li>
            
                <li><a href="..&#x2F;modules/auth.html">auth</a></li>
            
                <li><a href="..&#x2F;modules/collection.html">collection</a></li>
            
                <li><a href="..&#x2F;modules/model.html">model</a></li>
            
                <li><a href="..&#x2F;modules/router.html">router</a></li>
            
                <li><a href="..&#x2F;modules/session.html">session</a></li>
            
                <li><a href="..&#x2F;modules/storage.html">storage</a></li>
            
                <li><a href="..&#x2F;modules/umobile.html">umobile</a></li>
            
                <li><a href="..&#x2F;modules/utility.html">utility</a></li>
            
                <li><a href="..&#x2F;modules/view.html">view</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src&#x2F;js&#x2F;src&#x2F;app.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*global window:true, document:true, $:true, _:true, umobile:true, config:true, Backbone:true, console:true *&#x2F;

&#x2F;**
Main module for the umobile application. Namespaces
all source logic to the umobile namespace. Houses the
app, bootstrap, model, collection, view, auth and storage
submodules.

@module umobile
@namespace umobile
@main umobile
**&#x2F;
var umobile = {
	&#x2F;**
	Namespace for running instances that are needed across the
	umobile application.

	@submodule app
	@namespace app
	**&#x2F;
	app: {},

	&#x2F;**
	Namespace for umobile model implementations.
	Houses the Credential, Module and State model
	implementations.

	@submodule model
	@namespace model
	**&#x2F;
	model: {},

	&#x2F;**
	Namespace for umobile collection implementations.
	Houses the Module collection implementation.

	@submodule collection
	@namespace collection
	**&#x2F;
	collection: {},

	&#x2F;**
	Namespace for umobile view implementations.
	Houses the App, Credential and Module view
	implementations.

	@submodule view
	@namespace view
	**&#x2F;
	view: {},

	&#x2F;**
	Namespace for umobile router implementation.

	@submodule router
	@namespace router
	**&#x2F;
	router: {},

	&#x2F;**
	Namespace for the umobile authentication implementation.

	@submodule auth
	@namespace auth
	**&#x2F;
	auth: {},

	&#x2F;**
	Namespace for the umobile storage implementation.

	@submodule storage
	@namespace storage
	**&#x2F;
	storage: {},

	&#x2F;**
	Namespace for the umobile session implementation.

	@submodule session
	@namespace session
	**&#x2F;
	session: {},

	&#x2F;**
	Namespace for umobile utilities.

	@submodule utility
	@namespace utility
	**&#x2F;
	utility: {},

	&#x2F;**
	Method parses the data received by the session.established event.
	Iterates over layout JSON and adds modules (i.e. portlets) to
	the modues array based upon the number of portlets described
	by the JSON feed. The modules array is then returned.

	@method buildModuleArray
	@param {Object} data Object containing layout and portlet information.
	@return {Array} modules Array of module objects.
	**&#x2F;
	buildModuleArray: function (data) {
		&#x27;use strict&#x27;;
		&#x2F;&#x2F; Define.
		var modules, folders;

		&#x2F;&#x2F; Initialize.
		modules = [];
		folders = (data &amp;&amp; !_.isEmpty(data)) ? data.layout.folders : {};

		&#x2F;&#x2F; Iterate over folders.
		_.each(folders, function (folder, idx) {
			var portlets = folder.portlets;

			&#x2F;&#x2F; Iterate over portlets.
			_.each(portlets, function (portlet, idx) {
				portlet.id = portlet.fname;

				&#x2F;&#x2F; Parse the config.nativeIcons object for a property
				&#x2F;&#x2F; that matches the portlet.fname. If one is found, set
				&#x2F;&#x2F; the icon url to leverage a locally stored icon. If a
				&#x2F;&#x2F; match is not found, set the icon url to an icon on the
				&#x2F;&#x2F; server.
				if (config.nativeIcons[portlet.fname]) {
					portlet.iconUrl = &#x27;images&#x2F;icons&#x2F;&#x27; + config.nativeIcons[portlet.fname];
				} else {
					portlet.iconUrl = config.uPortalServerUrl + portlet.iconUrl;
				}

				&#x2F;&#x2F; Parse the config.nativeModules object for a property that
				&#x2F;&#x2F; matches the portlet.fname. If one is found, the module or
				&#x2F;&#x2F; portlet is natively supported. Set the portlet url to a local
				&#x2F;&#x2F; implementation (i.e., map.html). Otherwise, set the portlet url
				&#x2F;&#x2F; to an implementation located on the server.
				if (config.nativeModules[portlet.fname]) {
					portlet.url = config.nativeModules[portlet.fname];
					portlet.isNative = true;
				} else {
					portlet.url = config.uMobileServerUrl + portlet.url;
					portlet.isNative = false;
				}

				&#x2F;&#x2F; Define hasNewItem property based upon the newItemCount property.
				portlet.hasNewItem = (!Number(portlet.newItemCount)) ? false : true;

				&#x2F;&#x2F; Truncate portlet title.
				portlet.fullTitle = portlet.title;
				portlet.title = umobile.utility.Utils.truncate(portlet.title);

				modules.push(new umobile.model.Module(portlet));
			}, this);
		}, this);

		return modules;
	},

	&#x2F;**
	Method leverages the SessionTracker plugin to determine
	whether or not a valid session still exists.

	@method checkSession
	**&#x2F;
	checkSession: function () {
		&#x27;use strict&#x27;;
		umobile.session.SessionTracker.get(_.bind(function (time) {

			&#x2F;&#x2F; Define.
			var now, lastSession, sessionTimeout;

			&#x2F;&#x2F; Update the &#x27;lastSessionAccess&#x27; property.
			if (time !== 0) {
				umobile.app.stateModel.save({lastSessionAccess: time});
			}

			&#x2F;&#x2F; Determine if our session has expired.
			now = Number((new Date()).getTime());
			lastSession = Number(umobile.app.stateModel.get(&#x27;lastSessionAccess&#x27;));
			sessionTimeout = Number(config.sessionTimeout);

			&#x2F;&#x2F; When session exists, fetch modules from module collection.
			&#x2F;&#x2F; When the session has expired, attempt to re-establish a session.
			if ((now - lastSession) &lt; sessionTimeout) {
				umobile.app.moduleCollection.fetch();
			} else {
				umobile.auth.establishSession();
			}
		}, this));
	},

	&#x2F;**
	Method updates the State and Credential models. This
	interaction happens behind the scenes. For both models,
	the fetch method searches the storage implemenation for
	existing state. If found, the existing state is used to
	update the models. If not found, the default state of each
	model is preserved.

	@method updateAppState
	**&#x2F;
	updateAppState: function () {
		&#x27;use strict&#x27;;
		umobile.app.stateModel.fetch({
			success: _.bind(function (stateModel) {
				umobile.app.credModel.fetch({
					success: _.bind(function (credModel) {
						umobile.checkSession();
					}, this)
				});
			}, this)
		});
	},

	&#x2F;**
	Initializes the router for the application.

	@method initRouter
	**&#x2F;
	initRouter: function () {
		&#x27;use strict&#x27;;
		umobile.app.router = new umobile.router.RouteManager();
		Backbone.history.start();
	},

	&#x2F;**
	Method initializes the State and Credential models as well as
	the Module collection during the bootstrap phase.

	@method initModels
	**&#x2F;
	initModels: function () {
		&#x27;use strict&#x27;;
		umobile.app.stateModel = new umobile.model.State();
		umobile.app.credModel = new umobile.model.Credential();
		umobile.app.moduleCollection = new umobile.collection.ModuleCollection();
	},

	&#x2F;**
	Method registers subscribed events.

	@method initEventListeners
	**&#x2F;
	initEventListeners: function () {
		&#x27;use strict&#x27;;

		&#x2F;&#x2F; Subscribe to &#x27;session.established&#x27; event.
		&#x2F;&#x2F; When triggered, updates the State model and SessionTracker.
		$.subscribe(&#x27;session.established&#x27;, _.bind(function (data) {
			&#x2F;&#x2F; Define.
			var modules;

			&#x2F;&#x2F; Update credentials.
			umobile.app.credModel.save({username: data.user});

			&#x2F;&#x2F; Update state.
			umobile.app.stateModel.save({
				lastSessionAccess: (new Date()).getTime(),
				authenticated: (umobile.app.credModel.get(&#x27;username&#x27;)) ? true : false
			});

			&#x2F;&#x2F; Build module array.
			&#x2F;&#x2F; Populate the collection with modules.
			modules = umobile.buildModuleArray(data);
			umobile.app.moduleCollection.reset(modules);
			umobile.app.moduleCollection.save();

			&#x2F;&#x2F; Update time in the Session Tracker.
			umobile.session.SessionTracker.set(umobile.app.stateModel.get(&#x27;lastSessionAccess&#x27;));

			&#x2F;&#x2F; Redirect user to dashboard.
			umobile.app.router.navigate(&#x27;dashboard&#x27;, {trigger: true});
		}, this));

		&#x2F;&#x2F; Subscribe to &#x27;session.failure&#x27; event.
		$.subscribe(&#x27;session.failure&#x27;, _.bind(function () {
			umobile.app.moduleCollection.reset({});

			&#x2F;&#x2F; Direct users to the login screen.
			umobile.app.router.navigate(&#x27;login&#x27;, {trigger: true});
		}, this));
	},

	&#x2F;**
	The deviceready event is a part of the PhoneGap API. This is a very important
	event that every PhoneGap application should use. PhoneGap consists of two code
	bases: native and JavaScript. While the native code is loading, a custom loading
	image is displayed. However, JavaScript is only loaded once the DOM loads. This
	means the application could, potentially, call a PhoneGap JavaScript function
	before it is loaded.

	The PhoneGap deviceready event fires once PhoneGap has fully loaded. After the
	device has fired, you can safely make calls to PhoneGap function.

	@method onDeviceReady
	**&#x2F;
	onDeviceReady: function () {
		&#x27;use strict&#x27;;

		umobile.initEventListeners();
		umobile.initModels();
		umobile.initRouter();
		umobile.updateAppState();
	},

	&#x2F;**
	Entry point for the umobile application.
	Registers the PhoneGap deviceready event.

	@method initialize
	**&#x2F;
	initialize: function () {
		&#x27;use strict&#x27;;
		&#x2F;&#x2F; Listen to onDeviceReady event.
		document.addEventListener(&#x27;deviceready&#x27;, umobile.onDeviceReady, false);
		if (config.loginFn === &#x27;mockLogin&#x27;) {
			umobile.onDeviceReady();
		}
	}
};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
