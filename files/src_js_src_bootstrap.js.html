<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\src\bootstrap.js - uMobile</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="uMobile"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/App.html">App</a></li>
            
                <li><a href="..&#x2F;classes/bootstrap.html">bootstrap</a></li>
            
                <li><a href="..&#x2F;classes/Credential.html">Credential</a></li>
            
                <li><a href="..&#x2F;classes/getSession.html">getSession</a></li>
            
                <li><a href="..&#x2F;classes/Module.html">Module</a></li>
            
                <li><a href="..&#x2F;classes/ModuleCollection.html">ModuleCollection</a></li>
            
                <li><a href="..&#x2F;classes/Session.html">Session</a></li>
            
                <li><a href="..&#x2F;classes/SessionTrackerMock.html">SessionTrackerMock</a></li>
            
                <li><a href="..&#x2F;classes/State.html">State</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/app.html">app</a></li>
            
                <li><a href="..&#x2F;modules/auth.html">auth</a></li>
            
                <li><a href="..&#x2F;modules/collection.html">collection</a></li>
            
                <li><a href="..&#x2F;modules/model.html">model</a></li>
            
                <li><a href="..&#x2F;modules/storage.html">storage</a></li>
            
                <li><a href="..&#x2F;modules/umobile.html">umobile</a></li>
            
                <li><a href="..&#x2F;modules/view.html">view</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\js\src\bootstrap.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*global window:true, document:true, jQuery:true, _:true, umobile:true, config:true, Backbone:true, console:true *&#x2F;
(function ($, _, umobile, config) {
	&#x27;use strict&#x27;;

	&#x2F;&#x2F; Document.ready.
	$(function () {

		&#x2F;**
		...

		@method getUrlParam
		@private
		**&#x2F;
		var getUrlParam = function (name) {
			var result = new RegExp(&#x27;[\\?&amp;]&#x27; + name + &#x27;=([^&amp;#]*)&#x27;).exec(window.location.href);
			return (!result) ? null : result[1] || 0;
		};

		&#x2F;**
		...

		@class bootstrap
		@constructor
		**&#x2F;
		umobile.bootstrap = {
			app: {},

			&#x2F;**
			Parses the data broadcasted by the Session.getSession() method.
			Iterates over the layout JSON and adds modules (i.e. portlets)
			to the ModuleCollection based upon the number of portlets
			contained within the JSON feed.

			@method buildModuleCollection
			@param {Object} data Object containing layout and portlet information.
			**&#x2F;
			buildModuleCollection: function (data) {
				&#x2F;&#x2F; Define.
				var modules, folders;

				&#x2F;&#x2F; Initialize.
				modules = [];
				folders = data.layout.folders;

				&#x2F;&#x2F; Iterate over folders.
				_.each(folders, function (folder, idx) {
					var portlets = folder.portlets;

					&#x2F;&#x2F; Iterate over portlets.
					_.each(portlets, function (portlet, idx) {
						portlet.id = portlet.fname;

						&#x2F;&#x2F; Parse the config.nativeIcons object for a property
						&#x2F;&#x2F; that matches the portlet.fname. If one is found, set
						&#x2F;&#x2F; the icon url to leverage a locally stored icon. If a
						&#x2F;&#x2F; match is not found, set the icon url to an icon on the
						&#x2F;&#x2F; server.
						if (config.nativeIcons[portlet.fname]) {
							portlet.iconUrl = &quot;images&#x2F;icons&#x2F;&quot; + config.nativeIcons[portlet.fname];
						} else {
							portlet.iconUrl = config.uPortalServerUrl + portlet.iconUrl;
						}

						&#x2F;&#x2F; Parse the config.nativeModules object for a property that
						&#x2F;&#x2F; matches the portlet.fname. If one is found, the module or
						&#x2F;&#x2F; portlet is natively supported. Set the portlet url to a local
						&#x2F;&#x2F; implementation (i.e., map.html). Otherwise, set the portlet url
						&#x2F;&#x2F; to an implementation located on the server.
						if (config.nativeModules[portlet.fname]) {
							portlet.url = config.nativeModules[portlet.fname];
							portlet.isNative = true;
						} else {
							portlet.url = config.uMobileServerUrl + portlet.url;
						}

						modules.push(new umobile.model.Module(portlet));
					}, this);
				}, this);

				&#x2F;&#x2F; Add all modules to the module collection.
				this.app.moduleCollection.reset(modules);

				&#x2F;&#x2F; Update state.
				this.app.stateModel.save({
					&#x27;lastSessionAccess&#x27;: (new Date()).getTime(),
					&#x27;authenticated&#x27;: this.app.credModel.get(&quot;username&quot;) ? true : false
				});

				&#x2F;&#x2F; Update time in the Session Tracker.
				umobile.SessionTracker.set(this.app.stateModel.get(&#x27;lastSessionAccess&#x27;));

				&#x2F;&#x2F; Save the collection.
				this.app.moduleCollection.save({
					success: function () {}
				});
			},

			&#x2F;**
			Success handler for the Credential request.

			@method credSuccessHandler
			**&#x2F;
			credSuccessHandler: function (model, response, options) {
				umobile.SessionTracker.get(_.bind(function (time) {
					var module, now, lastSession;

					&#x2F;&#x2F; Search the url for the module parameter.
					&#x2F;&#x2F; If found, update the &#x27;currentView&#x27; property.
					module = getUrlParam(&#x27;module&#x27;);
					if (module) {
						this.app.stateModel.save(&#x27;currentView&#x27;, module);
					}

					&#x2F;&#x2F; Update the &#x27;lastSessionAccess&#x27; property.
					if (time !== 0) {
						this.app.stateModel.save(&#x27;lastSessionAccess&#x27;, time);
					}

					&#x2F;&#x2F; Fetch list of modules from the server and render the application.
					&#x2F;&#x2F; Or fetch a collection of modules from an existing session and render.
					now = (new Date()).getTime();
					lastSession = Number(this.app.stateModel.get(&#x27;lastSessionAccess&#x27;));
					if ((now - lastSession) &lt; (1000 * 60 * 10)) {
						this.app.moduleCollection.fetch({success: function () {}});
					} else {
						umobile.Session.getSession();
					}
				}, this));
			},

			&#x2F;**
			Generic error handler for failed requests.

			@method errorHandler
			**&#x2F;
			errorHandler: function (model, xhr, options) {
				console.log(&#x27;Error: &#x27; + model + &#x27;, &#x27; + xhr);
			},

			&#x2F;**
			When triggered, the onDeviceReady() method renders a
			loader to end users, initializes the main application
			view and starts the process of requesting data.

			@method onDeviceReady
			**&#x2F;
			onDeviceReady: function () {
				&#x2F;&#x2F; Show loader.
				$.mobile.showPageLoadingMsg(&quot;a&quot;, &quot;Loading modules&quot;);

				&#x2F;&#x2F; Initialize the main application view.
				this.app.appView = new umobile.view.App();

				&#x2F;&#x2F; Fetch state.
				this.app.stateModel.fetch({
					success: _.bind(function (model, response, options) {
						&#x2F;&#x2F; Fetch credentials.
						this.app.credModel.fetch({
							success: this.credSuccessHandler,
							error: this.errorHandler
						});
					}, this),
					error: this.errorHandler
				});
			},

			&#x2F;**
			Method adds the &#x27;deviceready&#x27; event listener to the document.
			When triggered, the onDeviceReady() method is called.

			@method initEventListener
			**&#x2F;
			initEventListener: function () {
				&#x2F;&#x2F; onDeviceReady event.
				document.addEventListener(&quot;deviceready&quot;, this.onDeviceReady, false);
				if (config.loginFn === &#x27;mockLogin&#x27;) {
					this.onDeviceReady();
				}

				&#x2F;&#x2F; Subscribe to &#x27;session.retrieved&#x27; event.
				$.subscribe(&#x27;session.retrieved&#x27;, _.bind(function (data) {
					this.buildModuleCollection(data);
				}, this));
			},

			&#x2F;**
			Method initializes the State and Credential models as well as
			the Module collection during the bootstrap phase.

			@method initModels
			**&#x2F;
			initModels: function () {
				this.app = umobile.app;
				this.app.stateModel = new umobile.model.State();
				this.app.credModel = new umobile.model.Credential();
				this.app.moduleCollection = new umobile.collection.ModuleCollection();
			},

			&#x2F;**
			Entry point for the umobile application.
			Method kicks off the bootstrap process.

			@method init
			**&#x2F;
			initialize: function () {
				_.bindAll(this);
				this.initModels();
				this.initEventListener();
			}
		};

		umobile.bootstrap.initialize();
	});

})(jQuery, _, umobile, config);
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
